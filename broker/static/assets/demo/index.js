// [{ 'date': '2019-12-23', 'close': 1793 }, { 'date': '2019-12-24', 'close': 1789.21 }, { 'date': '2019-12-26', 'close': 1868.77 }, { 'date': '2019-12-27', 'close': 1869.8 }, { 'date': '2019-12-30', 'close': 1846.89 }, { 'date': '2019-12-31', 'close': 1847.84 }, { 'date': '2020-01-02', 'close': 1898.01 }, { 'date': '2020-01-03', 'close': 1874.97 }, { 'date': '2020-01-06', 'close': 1902.88 }, { 'date': '2020-01-07', 'close': 1906.86 }, { 'date': '2020-01-08', 'close': 1891.97 }, { 'date': '2020-01-09', 'close': 1901.05 }, { 'date': '2020-01-10', 'close': 1883.16 }, { 'date': '2020-01-13', 'close': 1891.3 }, { 'date': '2020-01-14', 'close': 1869.44 }, { 'date': '2020-01-15', 'close': 1862.02 }, { 'date': '2020-01-16', 'close': 1877.94 }, { 'date': '2020-01-17', 'close': 1864.72 }, { 'date': '2020-01-21', 'close': 1892 }, { 'date': '2020-01-22', 'close': 1887.46 }, { 'date': '2020-01-23', 'close': 1884.58 }, { 'date': '2020-01-24', 'close': 1861.64 }, { 'date': '2020-01-27', 'close': 1828.34 }, { 'date': '2020-01-28', 'close': 1853.25 }, { 'date': '2020-01-29', 'close': 1858 }, { 'date': '2020-01-30', 'close': 1870.68 }, { 'date': '2020-01-31', 'close': 2008.72 }, { 'date': '2020-02-03', 'close': 2004.2 }, { 'date': '2020-02-04', 'close': 2049.67 }, { 'date': '2020-02-05', 'close': 2039.87 }, { 'date': '2020-02-06', 'close': 2050.23 }, { 'date': '2020-02-07', 'close': 2079.28 }, { 'date': '2020-02-10', 'close': 2133.91 }, { 'date': '2020-02-11', 'close': 2150.8 }, { 'date': '2020-02-12', 'close': 2160 }, { 'date': '2020-02-13', 'close': 2149.87 }, { 'date': '2020-02-14', 'close': 2134.87 }, { 'date': '2020-02-18', 'close': 2155.67 }, { 'date': '2020-02-19', 'close': 2170.22 }, { 'date': '2020-02-20', 'close': 2153.1 }, { 'date': '2020-02-21', 'close': 2095.97 }, { 'date': '2020-02-24', 'close': 2009.29 }, { 'date': '2020-02-25', 'close': 1972.74 }, { 'date': '2020-02-26', 'close': 1979.59 }, { 'date': '2020-02-27', 'close': 1884.3 }, { 'date': '2020-02-28', 'close': 1883.75 }, { 'date': '2020-03-02', 'close': 1953.95 }, { 'date': '2020-03-03', 'close': 1908.99 }, { 'date': '2020-03-04', 'close': 1975.83 }, { 'date': '2020-03-05', 'close': 1924.03 }, { 'date': '2020-03-06', 'close': 1901.09 }, { 'date': '2020-03-09', 'close': 1800.61 }, { 'date': '2020-03-10', 'close': 1891.82 }, { 'date': '2020-03-11', 'close': 1820.86 }, { 'date': '2020-03-12', 'close': 1676.61 }, { 'date': '2020-03-13', 'close': 1785 }, { 'date': '2020-03-16', 'close': 1689.15 }, { 'date': '2020-03-17', 'close': 1807.84 }, { 'date': '2020-03-18', 'close': 1830 }, { 'date': '2020-03-19', 'close': 1880.93 }, { 'date': '2020-03-20', 'close': 1846.09 }, { 'date': '2020-03-23', 'close': 1902.83 }, { 'date': '2020-03-24', 'close': 1940.1 }, { 'date': '2020-03-25', 'close': 1885.84 }, { 'date': '2020-03-26', 'close': 1955.49 }, { 'date': '2020-03-27', 'close': 1900.1 }, { 'date': '2020-03-30', 'close': 1963.95 }, { 'date': '2020-03-31', 'close': 1949.72 }, { 'date': '2020-04-01', 'close': 1907.7 }, { 'date': '2020-04-02', 'close': 1918.83 }, { 'date': '2020-04-03', 'close': 1906.59 }, { 'date': '2020-04-06', 'close': 1997.59 }, { 'date': '2020-04-07', 'close': 2011.6 }, { 'date': '2020-04-08', 'close': 2043 }, { 'date': '2020-04-09', 'close': 2042.76 }, { 'date': '2020-04-13', 'close': 2168.87 }, { 'date': '2020-04-14', 'close': 2283.32 }, { 'date': '2020-04-15', 'close': 2307.68 }, { 'date': '2020-04-16', 'close': 2408.19 }, { 'date': '2020-04-17', 'close': 2375 }, { 'date': '2020-04-20', 'close': 2393.61 }, { 'date': '2020-04-21', 'close': 2328.12 }, { 'date': '2020-04-22', 'close': 2363.49 }, { 'date': '2020-04-23', 'close': 2399.45 }, { 'date': '2020-04-24', 'close': 2410.22 }, { 'date': '2020-04-27', 'close': 2376 }, { 'date': '2020-04-28', 'close': 2314.08 }, { 'date': '2020-04-29', 'close': 2372.71 }, { 'date': '2020-04-30', 'close': 2474 }, { 'date': '2020-05-01', 'close': 2286.04 }, { 'date': '2020-05-04', 'close': 2315.99 }, { 'date': '2020-05-05', 'close': 2317.8 }, { 'date': '2020-05-06', 'close': 2351.26 }, { 'date': '2020-05-07', 'close': 2367.61 }, { 'date': '2020-05-08', 'close': 2379.61 }, { 'date': '2020-05-11', 'close': 2409 }, { 'date': '2020-05-12', 'close': 2356.95 }, { 'date': '2020-05-13', 'close': 2367.92 }, { 'date': '2020-05-14', 'close': 2388.85 }, { 'date': '2020-05-15', 'close': 2409.78 }, { 'date': '2020-05-18', 'close': 2426.26 }, { 'date': '2020-05-19', 'close': 2449.33 }, { 'date': '2020-05-20', 'close': 2497.94 }, { 'date': '2020-05-21', 'close': 2446.74 }, { 'date': '2020-05-22', 'close': 2436.88 }, { 'date': '2020-05-26', 'close': 2421.86 }, { 'date': '2020-05-27', 'close': 2410.39 }, { 'date': '2020-05-28', 'close': 2401.1 }, { 'date': '2020-05-29', 'close': 2442.37 }, { 'date': '2020-06-01', 'close': 2471.04 }, { 'date': '2020-06-02', 'close': 2472.41 }, { 'date': '2020-06-03', 'close': 2478.4 }, { 'date': '2020-06-04', 'close': 2460.6 }, { 'date': '2020-06-05', 'close': 2483 }, { 'date': '2020-06-08', 'close': 2524.06 }, { 'date': '2020-06-09', 'close': 2600.86 }, { 'date': '2020-06-10', 'close': 2647.45 }, { 'date': '2020-06-11', 'close': 2557.96 }, { 'date': '2020-06-12', 'close': 2545.02 }, { 'date': '2020-06-15', 'close': 2572.68 }, { 'date': '2020-06-16', 'close': 2615.27 }, { 'date': '2020-06-17', 'close': 2640.98 }, { 'date': '2020-06-18', 'close': 2653.98 }, { 'date': '2020-06-19', 'close': 2675.01 }, { 'date': '2020-06-22', 'close': 2713.82 }, { 'date': '2020-06-23', 'close': 2764.41 }, { 'date': '2020-06-24', 'close': 2734.4 }, { 'date': '2020-06-25', 'close': 2754.58 }, { 'date': '2020-06-26', 'close': 2692.87 }, { 'date': '2020-06-29', 'close': 2680.38 }, { 'date': '2020-06-30', 'close': 2758.82 }, { 'date': '2020-07-01', 'close': 2878.7 }, { 'date': '2020-07-02', 'close': 2890.3 }, { 'date': '2020-07-06', 'close': 3057.04 }, { 'date': '2020-07-07', 'close': 3000.12 }, { 'date': '2020-07-08', 'close': 3081.11 }, { 'date': '2020-07-09', 'close': 3182.63 }, { 'date': '2020-07-10', 'close': 3200 }, { 'date': '2020-07-13', 'close': 3104 }, { 'date': '2020-07-14', 'close': 3084 }, { 'date': '2020-07-15', 'close': 3008.87 }, { 'date': '2020-07-16', 'close': 2999.9 }, { 'date': '2020-07-17', 'close': 2961.97 }, { 'date': '2020-07-20', 'close': 3196.84 }, { 'date': '2020-07-21', 'close': 3138.29 }, { 'date': '2020-07-22', 'close': 3099.91 }, { 'date': '2020-07-23', 'close': 2986.55 }, { 'date': '2020-07-24', 'close': 3008.91 }, { 'date': '2020-07-27', 'close': 3055.21 }, { 'date': '2020-07-28', 'close': 3000.33 }, { 'date': '2020-07-29', 'close': 3033.53 }, { 'date': '2020-07-30', 'close': 3051.88 }, { 'date': '2020-07-31', 'close': 3164.68 }, { 'date': '2020-08-03', 'close': 3111.89 }, { 'date': '2020-08-04', 'close': 3138.83 }, { 'date': '2020-08-05', 'close': 3205.03 }, { 'date': '2020-08-06', 'close': 3225 }, { 'date': '2020-08-07', 'close': 3167.46 }, { 'date': '2020-08-10', 'close': 3148.16 }, { 'date': '2020-08-11', 'close': 3080.67 }, { 'date': '2020-08-12', 'close': 3162.24 }, { 'date': '2020-08-13', 'close': 3161.02 }, { 'date': '2020-08-14', 'close': 3148.02 }, { 'date': '2020-08-17', 'close': 3182.41 }, { 'date': '2020-08-18', 'close': 3312.49 }, { 'date': '2020-08-19', 'close': 3260.48 }, { 'date': '2020-08-20', 'close': 3297.37 }, { 'date': '2020-08-21', 'close': 3284.72 }, { 'date': '2020-08-24', 'close': 3307.46 }, { 'date': '2020-08-25', 'close': 3346.49 }, { 'date': '2020-08-26', 'close': 3441.85 }, { 'date': '2020-08-27', 'close': 3400 }, { 'date': '2020-08-28', 'close': 3401.8 }, { 'date': '2020-08-31', 'close': 3450.96 }, { 'date': '2020-09-01', 'close': 3499.12 }, { 'date': '2020-09-02', 'close': 3531.45 }, { 'date': '2020-09-03', 'close': 3368 }, { 'date': '2020-09-04', 'close': 3294.62 }, { 'date': '2020-09-08', 'close': 3149.84 }, { 'date': '2020-09-09', 'close': 3268.61 }, { 'date': '2020-09-10', 'close': 3175.11 }, { 'date': '2020-09-11', 'close': 3116.22 }, { 'date': '2020-09-14', 'close': 3102.97 }, { 'date': '2020-09-15', 'close': 3156.13 }, { 'date': '2020-09-16', 'close': 3078.1 }, { 'date': '2020-09-17', 'close': 3008.73 }, { 'date': '2020-09-18', 'close': 2954.91 }, { 'date': '2020-09-21', 'close': 2960.47 }, { 'date': '2020-09-22', 'close': 3128.99 }, { 'date': '2020-09-23', 'close': 2999.86 }, { 'date': '2020-09-24', 'close': 3019.79 }, { 'date': '2020-09-25', 'close': 3095.13 }, { 'date': '2020-09-28', 'close': 3174.05 }, { 'date': '2020-09-29', 'close': 3144.88 }, { 'date': '2020-09-30', 'close': 3148.73 }, { 'date': '2020-10-01', 'close': 3221.26 }, { 'date': '2020-10-02', 'close': 3125 }, { 'date': '2020-10-05', 'close': 3199.2 }, { 'date': '2020-10-06', 'close': 3099.96 }, { 'date': '2020-10-07', 'close': 3195.69 }, { 'date': '2020-10-08', 'close': 3190.55 }, { 'date': '2020-10-09', 'close': 3286.65 }, { 'date': '2020-10-12', 'close': 3442.93 }, { 'date': '2020-10-13', 'close': 3443.63 }, { 'date': '2020-10-14', 'close': 3363.71 }, { 'date': '2020-10-15', 'close': 3338.65 }, { 'date': '2020-10-16', 'close': 3272.71 }, { 'date': '2020-10-19', 'close': 3207.21 }, { 'date': '2020-10-20', 'close': 3217.01 }, { 'date': '2020-10-21', 'close': 3184.94 }, { 'date': '2020-10-22', 'close': 3176.4 }, { 'date': '2020-10-23', 'close': 3204.4 }, { 'date': '2020-10-26', 'close': 3207.04 }, { 'date': '2020-10-27', 'close': 3286.33 }, { 'date': '2020-10-28', 'close': 3162.78 }, { 'date': '2020-10-29', 'close': 3211.01 }, { 'date': '2020-10-30', 'close': 3036.15 }, { 'date': '2020-11-02', 'close': 3004.48 }, { 'date': '2020-11-03', 'close': 3048.41 }, { 'date': '2020-11-04', 'close': 3241.16 }, { 'date': '2020-11-05', 'close': 3322 }, { 'date': '2020-11-06', 'close': 3311.37 }, { 'date': '2020-11-09', 'close': 3143.74 }, { 'date': '2020-11-10', 'close': 3035.02 }, { 'date': '2020-11-11', 'close': 3137.39 }, { 'date': '2020-11-12', 'close': 3110.28 }, { 'date': '2020-11-13', 'close': 3128.81 }, { 'date': '2020-11-16', 'close': 3131.06 }, { 'date': '2020-11-17', 'close': 3135.66 }, { 'date': '2020-11-18', 'close': 3105.46 }, { 'date': '2020-11-19', 'close': 3117.02 }, { 'date': '2020-11-20', 'close': 3099.4 }, { 'date': '2020-11-23', 'close': 3098.39 }, { 'date': '2020-11-24', 'close': 3118.06 }, { 'date': '2020-11-25', 'close': 3185.07 }, { 'date': '2020-11-27', 'close': 3195.34 }, { 'date': '2020-11-30', 'close': 3168.04 }, { 'date': '2020-12-01', 'close': 3220.08 }, { 'date': '2020-12-02', 'close': 3203.53 }, { 'date': '2020-12-03', 'close': 3186.73 }, { 'date': '2020-12-04', 'close': 3162.58 }, { 'date': '2020-12-07', 'close': 3158 }, { 'date': '2020-12-08', 'close': 3177.29 }, { 'date': '2020-12-09', 'close': 3104.2 }, { 'date': '2020-12-10', 'close': 3101.49 }, { 'date': '2020-12-11', 'close': 3116.42 }, { 'date': '2020-12-14', 'close': 3156.97 }, { 'date': '2020-12-15', 'close': 3165.12 }, { 'date': '2020-12-16', 'close': 3240.96 }, { 'date': '2020-12-17', 'close': 3236.08 }, { 'date': '2020-12-18', 'close': 3201.65 }]

// Set new default font family and font color to mimic Bootstrap's default styling
Chart.defaults.global.defaultFontFamily = '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
Chart.defaults.global.defaultFontColor = '#292b2c';

brokerData()
    .then((broker_data) => {
        const labels = broker_data.x;
        const data = broker_data.y;
        const latestUpdate = labels[labels.length - 1]
        const brokerBalance = broker_data.balance;
        const brokerChangePer = parseFloat(broker_data.changePer);
        clr = 'black'
        if (brokerChangePer > 0) clr = 'forestgreen';
        if (brokerChangePer < 0) clr = 'red';

        document.getElementById("BALANCE").innerHTML = `<h1 style="display:inline">${brokerBalance} </h1> <h2 style="display:inline">  $</h2>`;
        document.getElementById("CHANGE").innerHTML = `<h1 style="display:inline; color:${clr}">${brokerChangePer} </h1> <h2 style="display:inline">  %</h2>`;
        document.getElementById("UPD").innerHTML = `Updated At ${latestUpdate} GMT`;


        draw(labels, data);
    });

async function brokerData() {
    const response = await fetch('/broker_data');
    const data = await response.json();


    console.log(data);
    // const tst = document.getElementById("api");
    // tst.innerHTML = data.days_since_joined;
    return data;
}
async function draw(labels, data) {

    // Area Chart Example
    var ctx = document.getElementById("myAreaChart");
    var myLineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels, //["Mar 1", "Mar 2", "Mar 3", "Mar 4", "Mar 5", "Mar 6", "Mar 7", "Mar 8", "Mar 9", "Mar 10", "Mar 11", "Mar 12", "Mar 13"],
            datasets: [{
                label: "Capital",
                lineTension: 0.3,
                hoverBackgroundColor: "rgba(136, 176, 75)",

                // backgroundColor: "rgba(2,117,216,0.2)",
                borderColor: "rgba(2,117,216,1)",
                pointRadius: 5,
                pointBackgroundColor: "rgba(2,117,216,1)",
                pointBorderColor: "rgba(255,255,255,0.8)",
                pointHoverRadius: 5,
                pointHoverBackgroundColor: "rgba(2,117,216,1)",
                pointHitRadius: 50,
                pointBorderWidth: 2,
                data: data //[10000, 30162, 26263, 18394, 18287, 28682, 31274, 33259, 25849, 24159, 32651, 31984, 38451],
            }],
        },
        options: {
            scales: {
                xAxes: [{
                    time: {
                        unit: 'date'
                    },
                    gridLines: {
                        display: false
                    },
                    ticks: {
                        maxTicksLimit: 50000
                    }
                }],
                yAxes: [{
                    ticks: {
                        min: 0,
                        max: 40000,
                        maxTicksLimit: 10
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, .125)",
                    }
                }],
            },
            legend: {
                display: false
            }
        }
    });
}